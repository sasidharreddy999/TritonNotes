---
layout: default
---

<div class="post-layout">
  <aside class="post-sidebar">
    <div class="post-info">
      <h1 class="post-title">{{ page.title | escape }}</h1>
      <div class="post-meta-sidebar">
        <div class="meta-item">
          <span class="meta-label">Published</span>
          <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time>
        </div>
        {% if page.categories.size > 0 %}
        <div class="meta-item">
          <span class="meta-label">Category</span>
          <span class="meta-value">{{ page.categories | join: ", " }}</span>
        </div>
        {% endif %}
        {% if page.tags.size > 0 %}
        <div class="meta-item">
          <span class="meta-label">Tags</span>
          <div class="tag-list">
            {% for tag in page.tags %}
            <span class="tag-minimal">{{ tag }}</span>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        <div class="meta-item">
          <span class="meta-label">Read time</span>
          <span class="meta-value">{{ content | number_of_words | divided_by: 200 | ceil }} min read</span>
        </div>
      </div>
      
      <div class="table-of-contents">
        <div class="toc-header" onclick="toggleTOC()">
          <h3>Contents</h3>
          <span class="toc-toggle" id="toc-toggle">▼</span>
        </div>
        <div class="toc-content" id="toc-content">
          <div id="toc"></div>
        </div>
      </div>
    </div>
  </aside>
  
  <main class="post-content">
    <article class="linear-article">
      {{ content }}
    </article>
    
    <nav class="post-navigation">
      {% if page.previous.url %}
        <a class="nav-prev" href="{{ page.previous.url | relative_url }}">&larr; {{ page.previous.title | truncate: 50 }}</a>
      {% endif %}
      {% if page.next.url %}
        <a class="nav-next" href="{{ page.next.url | relative_url }}">{{ page.next.title | truncate: 50 }} &rarr;</a>
      {% endif %}
    </nav>
  </main>
</div>

<script>
// Generate table of contents
document.addEventListener('DOMContentLoaded', function() {
  const toc = document.getElementById('toc');
  const headings = document.querySelectorAll('.linear-article h2, .linear-article h3, .linear-article h4');
  
  if (headings.length === 0) {
    document.querySelector('.table-of-contents').style.display = 'none';
    return;
  }
  
  let tocHTML = '<ul>';
  let currentLevel = 2;
  let openSections = []; // Track open sections
  
  headings.forEach(function(heading, index) {
    const id = 'heading-' + index;
    heading.id = id;
    const level = parseInt(heading.tagName.substring(1));
    const indent = level === 3 ? 'toc-h3' : level === 4 ? 'toc-h4' : '';
    
    // Close previous sections if needed
    while (openSections.length > 0 && openSections[openSections.length - 1] >= level) {
      tocHTML += '</ul></li>';
      openSections.pop();
    }
    
    // Add collapsible functionality for h2 headings
    if (level === 2) {
      tocHTML += `<li class="toc-section">
        <div class="toc-section-header" onclick="toggleSection(this)">
          <span class="toc-arrow">▶</span>
          <a href="#${id}">${heading.textContent}</a>
        </div>
        <ul class="toc-subsection">`;
      openSections.push(level);
    } else {
      tocHTML += `<li class="${indent}"><a href="#${id}">${heading.textContent}</a></li>`;
    }
  });
  
  // Close all remaining open sections
  while (openSections.length > 0) {
    tocHTML += '</ul></li>';
    openSections.pop();
  }
  
  tocHTML += '</ul>';
  toc.innerHTML = tocHTML;
  
  // Add active heading highlighting
  highlightActiveHeading();
  window.addEventListener('scroll', highlightActiveHeading);
});

// Toggle table of contents visibility
function toggleTOC() {
  const content = document.getElementById('toc-content');
  const toggle = document.getElementById('toc-toggle');
  
  if (content.style.display === 'none') {
    content.style.display = 'block';
    toggle.textContent = '▼';
  } else {
    content.style.display = 'none';
    toggle.textContent = '▶';
  }
}

// Toggle individual sections in TOC
function toggleSection(header) {
  const arrow = header.querySelector('.toc-arrow');
  const subsection = header.parentElement.querySelector('.toc-subsection');
  
  if (subsection.style.display === 'none') {
    subsection.style.display = 'block';
    arrow.textContent = '▼';
  } else {
    subsection.style.display = 'none';
    arrow.textContent = '▶';
  }
}

// Highlight active heading in TOC
function highlightActiveHeading() {
  const headings = document.querySelectorAll('.linear-article h2, .linear-article h3, .linear-article h4');
  const tocLinks = document.querySelectorAll('.table-of-contents a');
  
  let activeHeading = null;
  
  headings.forEach(function(heading) {
    const rect = heading.getBoundingClientRect();
    if (rect.top <= 100) {
      activeHeading = heading;
    }
  });
  
  // Remove active class from all links
  tocLinks.forEach(function(link) {
    link.classList.remove('active');
  });
  
  // Add active class to current heading
  if (activeHeading) {
    const activeLink = document.querySelector(`a[href="#${activeHeading.id}"]`);
    if (activeLink) {
      activeLink.classList.add('active');
    }
  }
}

// Smooth scroll for TOC links
document.addEventListener('click', function(e) {
  if (e.target.matches('.table-of-contents a')) {
    e.preventDefault();
    const targetId = e.target.getAttribute('href').substring(1);
    const targetElement = document.getElementById(targetId);
    
    if (targetElement) {
      const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 100;
      window.scrollTo({
        top: offsetTop,
        behavior: 'smooth'
      });
    }
  }
});
</script>